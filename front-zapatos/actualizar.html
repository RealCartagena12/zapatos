<!DOCTYPE html>
<html lang="es">

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App Zapatos</title>
</head>

<body>
  <main>
    <h1>Actualizar zapato</h1>
    <!-- aquí va el formulario -->

    <form class="row row-cols-lg-auto g-3 align-items-center" id="formZapato">
      <label>Marca (brand)<br>
        <input name="brand" type="text" required>
      </label><br>
      <label>Modelo (model)<br>
        <input name="model" type="text" required>
      </label><br>
      <label>Talla (size, número)<br>
        <input name="size" type="number" required>
      </label><br>
      <label>Color<br>
        <input name="color" type="text" required>
      </label><br>
      <label>Precio (price)<br>
        <input name="price" type="number" required>
      </label><br>
      <label>Stock (opcional)<br>
        <input name="stock" type="number" placeholder="0">
      </label><br>
      <label>Tags (opcional, separa por comas)<br>
        <input name="tags" type="text" placeholder="running,hombre">
      </label><br><br>


    <br><br>
    <button class="btn btn-primary" id="btnEnviar" type="submit">Actualizar zapato</button>
  
    </form>


    <p id="msg"></p>
    <pre id="out"></pre>
  </main>
  <!--shift+alt+f-->
  <script src="index.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>  
</body>
</html>

<script>
  document.addEventListener('DOMContentLoaded', async function(){
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");//sacando los parametros get
    console.log(id);

   const res =  await fetch(`http://localhost:3000/zapatos/${id}`);
      const zapato = await res.json(); 
      console.log(zapato);


      var form = document.getElementById("formZapato"); 
      var btn= document.getElementById("btnEnviar");


      form.brand.value=zapato.data.brand || "";
      form.model.value=zapato.data.model || "";
      form.size.value=zapato.data.size || "";
      form.color.value=zapato.data.color|| "";
      form.price.value=zapato.data.price|| "";
      form.stock.value=zapato.data.stock|| "";
      form.tags.value=zapato.data.tags||"";


      form.addEventListener('submit', async (e) => {
  e.preventDefault();
  msg.textContent = " Guardando cambios...";

  const data = {
    brand: form.brand.value.trim(),
    model: form.model.value.trim(),
    size: Number(form.size.value),
    color: form.color.value.trim(),
    price: Number(form.price.value),
    stock: Number(form.stock.value),
    tags: form.tags.value.split(',').map(t => t.trim()).filter(Boolean)
  };

  try {
    const res = await fetch(`http://localhost:3000/zapatos/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    if (!res.ok) {
    throw new Error('Error al actualizar');
    
    }else {
    msg.textContent = " Zapato actualizado correctamente";
    }

  } catch (error) {
    console.error(error);
    msg.textContent = " Error al guardar los cambios.";
  }
});
  });


</script>
